<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gaugefield &mdash; SIMULATeQCD 0.7 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spinorfield" href="07_spinorfield.html" />
    <link rel="prev" title="Functor/operator() syntax" href="05_functorSyntax.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
            <a href="../index.html" class="icon icon-home"> SIMULATeQCD
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_gettingStarted/gettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_contributions/contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_applications/applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="codeBase.html">Code base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_indexer.html">Indexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_fileWriter.html">File Writer</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_latticeContainer.html">Lattice Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_communicationBase.html">CommunicationBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_functorSyntax.html">Functor/operator() syntax</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gaugefield</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_spinorfield.html">Spinorfield</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_topology.html">Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../05_modules/modules.html">Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SIMULATeQCD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="codeBase.html">Code base</a> &raquo;</li>
      <li>Gaugefield</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/04_codeBase/06_gaugefield.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="gaugefield">
<h1>Gaugefield<a class="headerlink" href="#gaugefield" title="Permalink to this headline"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Gaugefield</span></code> class provides a template who has data member <code class="docutils literal notranslate"><span class="pre">_lattice</span></code> to store the
gauge links for all
the sites on a 4D lattice. Each link is an SU<span class="math notranslate nohighlight">\((\)</span>3<span class="math notranslate nohighlight">\()\)</span> matrix of data type <code class="docutils literal notranslate"><span class="pre">GSU3</span></code>. One could use
the indexer <code class="docutils literal notranslate"><span class="pre">GIndexer&lt;All,</span> <span class="pre">HaloDepth&gt;</span></code> to reach any link, including those in the halo.
There are also several function members</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">one();</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">random(uint4*</span> <span class="pre">rand_state);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gauss(uint4*</span> <span class="pre">rand_state);</span></code></p></li>
</ul>
<p>initiating the gauge links to some special numbers like unity, random numbers or Gaussian
algebra elements. Function <code class="docutils literal notranslate"><span class="pre">swap_memory(Gaugefield&lt;floatT,</span> <span class="pre">onDevice,</span> <span class="pre">HaloDepth,comp&gt;</span> <span class="pre">&amp;gauge)</span></code>
could swap two gauge fields <code class="docutils literal notranslate"><span class="pre">_lattice</span></code> and <code class="docutils literal notranslate"><span class="pre">gauge</span></code>.  Since the gauge links <code class="docutils literal notranslate"><span class="pre">_lattice</span></code> are
<code class="docutils literal notranslate"><span class="pre">protected</span></code>, one can only visit them via <code class="docutils literal notranslate"><span class="pre">getAccessor()</span></code>. <code class="docutils literal notranslate"><span class="pre">Gaugefield</span></code> also provides
overloading for <code class="docutils literal notranslate"><span class="pre">=</span></code>, so that one could easily copy one gauge field to another. And the gauge
links should always be unitary, so a <code class="docutils literal notranslate"><span class="pre">su3latunitarize</span></code> function is given.</p>
<p>Besides all the functions mentioned above, there are a bunch of convenient iterators with which
one could perform operations on each of the link considered:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateOverFullAllMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">);</span><span class="w"> </span><span class="c1">//perform &quot;op&quot; on all links including those in the halo in all 4 (spacetime) directions.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="n">deviceStream</span><span class="o">&lt;</span><span class="n">onDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iterateOverBulkAllMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">useStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">//perform &quot;op&quot; on all links excluding those in the halo in all 4 (spacetime) directions.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateOverFullLoopMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">);</span><span class="w"> </span><span class="c1">//perform &quot;op&quot; on all links including those in the halo for the first &quot;Nloops&quot; (default 4) directions.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateOverBulkLoopMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">);</span><span class="w"> </span><span class="c1">//perform &quot;op&quot; on all links excluding those in the halo for the first &quot;Nloops&quot; (default 4) directions.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateOverFullAtMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">);</span><span class="w">  </span><span class="c1">//perform &quot;op&quot; on all links including those in the halo in a specific direction &quot;Mu&quot;.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateOverBulkAtMu</span><span class="p">(</span><span class="n">Functor</span><span class="w"> </span><span class="n">op</span><span class="p">);</span><span class="w"> </span><span class="c1">//perform &quot;op&quot; on all links excluding those in the halo in a specific direction &quot;Mu&quot;.</span>

<span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">iterateWithConst</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">ob</span><span class="p">);</span><span class="w"> </span><span class="c1">//set all links including those in the halo in all 4 (spacetime) directions to a constant value &quot;ob&quot;.</span>
</pre></div>
</div>
<section id="reading-and-writing-gaugefields">
<h2>Reading and writing Gaugefields<a class="headerlink" href="#reading-and-writing-gaugefields" title="Permalink to this headline"></a></h2>
<p>Usually
before or after a lattice calculation one needs to read in or write out the gauge fields from/to
a file, and this can be done by the <code class="docutils literal notranslate"><span class="pre">readconf_*</span></code> and <code class="docutils literal notranslate"><span class="pre">writeconf_*</span></code> function members of
this template.</p>
<p>In lattice QCD calculations, there are several popular gauge configuration formats on the market.
These can differ in several ways, including how their header is implemented and how the to-be-saved
<code class="docutils literal notranslate"><span class="pre">Gaugefield</span></code> object is converted to binary. When deciding between ILDG and NERSC, note that
the ILDG takes up more storage space, since it’s not compressed. The benefit of ILDG is that
it has more informative metadata and it allows one to store configurations on the Lattice
Data Grid.</p>
<section id="ildg">
<h3>ILDG<a class="headerlink" href="#ildg" title="Permalink to this headline"></a></h3>
<p>The International Lattice Data Grid (ILDG) format has two main advantages, namely:</p>
<ol class="simple">
<li><p>The ILDG is the largest attempt by the lattice community to make gauge configurations
generated by groups around the world publicly available, and we strive to be part of that
community. If we would like to use their storage, we need to adhere to their format.</p></li>
<li><p>The ILDG format is perhaps the most descriptive (in the sense of metadata) and safe
(in the sense of being sensitive to corrupted configurations) format available to the
lattice community. More information about the ILDG effort can be found
<a class="reference external" href="https://hpc.desy.de/ildg/">here</a>. You may also be interested in
<a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0010465511000476">this</a> ILDG publication.</p></li>
</ol>
<p>A file saved in ILDG format format consists of several parts packaged using the
Lattice QCD Interchange Message
Encapsulation (LIME) format. LIME is organized as follows:</p>
<ul class="simple">
<li><p>One encapsulates ASCII or binary data into <em>records</em>.</p></li>
<li><p>The records are packaged into <em>messages</em>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">ildg-format</span></code> record is an XML document with some set of non-mutable parameters needed to
read the binary. Here is an example:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;ildgFormat</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.lqcd.org/ildg&quot;</span>
            <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
            <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.lqcd.org/ildg/filefmt.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;version&gt;</span> 1.0 <span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;field&gt;</span> su3gauge <span class="nt">&lt;/field&gt;</span>
  <span class="nt">&lt;precision&gt;</span> 32 <span class="nt">&lt;/precision&gt;</span>
  <span class="nt">&lt;lx&gt;</span> 20 <span class="nt">&lt;/lx&gt;</span> <span class="nt">&lt;ly&gt;</span> 20 <span class="nt">&lt;/ly&gt;</span> <span class="nt">&lt;lz&gt;</span> 20 <span class="nt">&lt;/lz&gt;</span> <span class="nt">&lt;lt&gt;</span> 64 <span class="nt">&lt;/lt&gt;</span>
<span class="nt">&lt;/ildgFormat&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ildg-binary-data</span></code> record is the stored binary data. It is a sequence of IEEE floating
point numbers. The precision is given in the <code class="docutils literal notranslate"><span class="pre">ildg-format</span></code> record. The endianness is big.
In this format a <code class="docutils literal notranslate"><span class="pre">Gaugefield</span></code> is stored as an 8 (or 7) dimensional array of floating point
(or complex) numbers. The dimensions ordered from slowest to fastest running index are</p>
<ol class="simple">
<li><p>site index <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>site index <span class="math notranslate nohighlight">\(z\)</span></p></li>
<li><p>site index <span class="math notranslate nohighlight">\(y\)</span></p></li>
<li><p>site index <span class="math notranslate nohighlight">\(x\)</span></p></li>
<li><p>direction index <span class="math notranslate nohighlight">\(\mu\)</span></p></li>
<li><p>color index <span class="math notranslate nohighlight">\(a\)</span></p></li>
<li><p>color index <span class="math notranslate nohighlight">\(b\)</span></p></li>
<li><p>index indicating real (0) or imaginary (1) part</p></li>
</ol>
<p>The last entry is the <code class="docutils literal notranslate"><span class="pre">checksum</span></code>, which is a number characteristic of some binary data.
Two checksums are calculated for ILDG, both of which are extremely sensitive to changes
in the binary file; indeed if even a single bit is changed, the <code class="docutils literal notranslate"><span class="pre">checksum</span></code> changes.
By comparing the expected <code class="docutils literal notranslate"><span class="pre">checksum</span></code> saved in the header of an ILDG file with the
calculated <code class="docutils literal notranslate"><span class="pre">checksum</span></code> upon read in, one can tell whether the file has been corrupted.</p>
<section id="more-about-lime">
<h4>More about LIME<a class="headerlink" href="#more-about-lime" title="Permalink to this headline"></a></h4>
<p>For detailed information about LIME, see its GitHub
project <a class="reference external" href="https://github.com/usqcd-software/c-lime">here</a>.
A LIME record is packed as follows:</p>
<ol class="simple">
<li><p>A 144-byte header</p></li>
<li><p>The data (maximum of <span class="math notranslate nohighlight">\(2^{63}\)</span> bytes)</p></li>
<li><p>Some null padding (0-7 bytes as needed)</p></li>
</ol>
<p>The header is organized into 18 64-bit (8 byte) <em>words</em> as follows:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>word</p></th>
<th class="text-align:left head"><p>content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>0</p></td>
<td class="text-align:left"><p>subheader</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>1</p></td>
<td class="text-align:left"><p>data length in bytes</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>2-17</p></td>
<td class="text-align:left"><p>128 byte LIME-type</p></td>
</tr>
</tbody>
</table>
<p>where the subheader consists of</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>bits</p></th>
<th class="text-align:left head"><p>content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>0-31</p></td>
<td class="text-align:left"><p>LIME magic number</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>32-47</p></td>
<td class="text-align:left"><p>LIME file version number</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>48</p></td>
<td class="text-align:left"><p>message begin bit</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>49</p></td>
<td class="text-align:left"><p>message end bit</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>50-63</p></td>
<td class="text-align:left"><p>reserved</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">int</span></code> LIME magic number, <span class="math notranslate nohighlight">\(1164413355_{10}=456789ab_{16}\)</span>, is used to identify
a record in LIME format. The version number is a <code class="docutils literal notranslate"><span class="pre">short</span> <span class="pre">int</span></code>. The three integer numbers in
the header, i.e. the magic number, version number, and data length, are written in
IEEE big-endian byte order for their data types, <code class="docutils literal notranslate"><span class="pre">long</span></code>, <code class="docutils literal notranslate"><span class="pre">short</span></code>, and
<code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code>, respectively.</p>
</section>
</section>
<section id="nersc">
<h3>NERSC<a class="headerlink" href="#nersc" title="Permalink to this headline"></a></h3>
<p>A NERSC format file consists of a simple header</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BEGIN_HEADER</span>
<span class="n">DATATYPE</span> <span class="o">=</span> <span class="mi">4</span><span class="n">D_SU3_GAUGE_3x3</span>
<span class="n">DIMENSION_1</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">DIMENSION_2</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">DIMENSION_3</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">DIMENSION_4</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">CHECKSUM</span> <span class="o">=</span> <span class="mi">436</span><span class="n">aa5c1</span>
<span class="n">LINK_TRACE</span> <span class="o">=</span> <span class="mf">0.002564709374</span>
<span class="n">PLAQUETTE</span> <span class="o">=</span> <span class="mf">0.311637549</span>
<span class="n">FLOATING_POINT</span> <span class="o">=</span> <span class="n">IEEE64BIG</span>
<span class="n">END_HEADER</span>
</pre></div>
</div>
<p>followed by the binary. The NERSC <code class="docutils literal notranslate"><span class="pre">checksum</span></code> is essentially a sum over all elements of
all links in the lattice. This <code class="docutils literal notranslate"><span class="pre">checksum</span></code> is not as sensitive as the ILDG checksum.
Reading/writing NERSC configurations to/from <code class="docutils literal notranslate"><span class="pre">Gaugefield</span></code> objects <code class="docutils literal notranslate"><span class="pre">gauge</span></code> can be
accomplished with</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">gauge</span><span class="p">.</span><span class="n">readconf_nersc</span><span class="p">(</span><span class="s">&quot;path/to/gaugefile&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">gauge</span><span class="p">.</span><span class="n">writeconf_nersc</span><span class="p">(</span><span class="s">&quot;path/to/gaugefile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">diskprec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">endianness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENDIAN_BIG</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>One can set either <code class="docutils literal notranslate"><span class="pre">rows</span></code> to 2 or 3, depending on whether one wants compressed
configurations. If one stores a compressed configuration, the NERSC reader calculates
the third row of each SU(3) link automatically. The precision <code class="docutils literal notranslate"><span class="pre">diskprec</span></code> can be 1 for
<code class="docutils literal notranslate"><span class="pre">float</span></code> or 2 for <code class="docutils literal notranslate"><span class="pre">double</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, LatticeQCD.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>